<!DOCTYPE html>
<html>
    <head>
        <%- title %>
        <%- icon %>
        <%- meta %>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi">
    </head>
    <style>
        :root {
            --staff-color: <%- chroma(config.staff_embed_color) %>;
            --user-color: <%- chroma(config.user_embed_color) %>;
        }
        body {
            padding-left: 2.5%;
            padding-right: 2.5%;
            padding-top: 2.5%;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 1vw;
        }

        
        .threadInfo {
            text-align: center;
            margin: 0 auto;
        }

        .p {
            padding: 1px;
        }

        /* card with light shadow around it for the message class */
        .user-message {
            position: relative;
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            transition: 0.3s;
            border-radius: .75vw;
            padding: 1vw;
            margin: 1vw;
            border-left: .75vw solid;
            border-color: var(--user-color);
        }

        .staff-message {
            position: relative;
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            transition: 0.3s;
            border-radius: .75vw;
            padding: 1vw;
            margin: 1vw;
            border-left: .75vw solid;
            border-color: var(--staff-color);
        }

        .message message-text {
            position: absolute;
            inline-size: 100%;
            overflow-wrap: break-word;
            line-height: 1.5vw;
        }

        code {
            background-color: lightgray;
            border-radius: 3px;
            padding: 2px;
        }

        .spoiler {
            color: black;
            background-color: black;
            border-radius: 3px;
            padding: 2px;
        }

        .spoiler:hover {
            color: white;
        }
    </style>
    <body style="background-color: lightgray;">
        <div class="threadInfo card shadow">
            <%- image %>
            <%- threadInfo %>
            <hr style="width: 20%; height: .15vw; border-width: 0px; color: black; background-color: black;">
        </div>

        <% messages.forEach(function(message) { %>
            <% var scriptRegex = /<script>([\s\S]*?)<\/script>/g; %>
            <% var imgRegex = /<img src="([\c\C]*?)">/g; %>
            <% if (message.internal) { %>
                <div class="staff-message">
                    <div class="message-author" style="padding-bottom: .5vw;">
                        <img src="<%- message.avatar %>" style="border-radius: 50%; height: 1.25vw; width: 1.25vw; padding-right: 5px;"><b><%- message.user %> <%- message.internal ? " (staff)" : "" %></b> -
                    </div>
                    <div class="message-text">
                        <%- message.content.replace(scriptRegex, '[script in message]').replace(imgRegex, '[image in message]') %>
                    </div>
                </div>
            <% } else if (!message.internal) { %>
                <div class="user-message">
                    <div class="message-author" style="padding-bottom: .5vw;">
                        <img src="<%- message.avatar %>" style="border-radius: 50%; height: 1.25vw; width: 1.25vw; padding-right: 5px;"><b><%- message.user %> <%- message.internal ? " (staff)" : "" %></b>
                    </div>
                    <div class="message-text">
                        <%- message.content.replace(scriptRegex, '[script in message]').replace(imgRegex, '[image in message]').split('\n').join('<br>') %>
                    </div>
                </div>
            <% } %> 
        <% }) %>
    </body>
</html>